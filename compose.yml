services:
  # no X11 mapping is included as it is hard for a beginner to set up an X11 server
  geant4: # docker compose run --service-ports geant4
    image: physino/geant4
    platform: linux/amd64
    command: /usr/bin/bash
    volumes: [ .:/root/geant4 ]
    # ports are only exposed by compose up, not compose run
    # --service-ports is needed for compose run to expose ports
    ports: [ 8888:8888, 8889:8889 ]
    environment: [ TZ=US/Central ]
    hostname: AlmaLinux
    build: container
  g4:
    image: physino/geant4:11.2.1
    platform: linux/amd64 # pre-compiled geant4 is not available for arm64
    profiles: [ "g4" ] # avoid running it by `compose up`
    command: /usr/bin/bash
    volumes: [ .:/root/geant4 ]
    # https://unix.stackexchange.com/a/698068/26929
    # https://stackoverflow.com/a/63291253/1801749
    environment: [ TZ=US/Central ]
    hostname: AlmaLinux # https://stackoverflow.com/a/63291253/1801749
    build: 11.2.1
  heprapp: # docker compose run --rm heprapp
    command: /usr/bin/hv # launch HepRApp
    image: physino/heprapp # https://hub.docker.com/r/physino/heprapp
    profiles: [ "heprapp" ]
    environment:
      - DISPLAY=host.docker.internal:0.0
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - .:/root/geant4
    # https://github.com/microsoft/WSL/issues/5339#issuecomment-1125709672
    # https://docs.docker.com/compose/compose-file/#sysctls
    sysctls:
      - net.ipv4.tcp_keepalive_intvl=60
      - net.ipv4.tcp_keepalive_probes=5
      - net.ipv4.tcp_keepalive_time=300

